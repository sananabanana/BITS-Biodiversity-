<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <title>BITS Hyderabad Biodiversity Atlas</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="">
  <style>
    /* â”€â”€â”€ Design Tokens â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    :root {
      --bg:           #0a0e17;
      --bg-elevated:  #0f1419;
      --panel:        #161b26;
      --panel-hover:  #1c2333;
      --border:       #2a3441;
      --border-bright:#3d4a5e;
      --muted:        #8b96a5;
      --text:         #e6edf3;
      --text-bright:  #ffffff;
      --accent:       #39d353;
      --accent-glow:  rgba(57,211,83,0.2);
      --accent2:      #58a6ff;
      --accent2-glow: rgba(88,166,255,0.2);
      --purple:       #bc8cff;
      --grad-1: linear-gradient(135deg,#667eea,#764ba2);
      --grad-2: linear-gradient(135deg,#f093fb,#f5576c);
      --grad-3: linear-gradient(135deg,#4facfe,#00f2fe);
    }

    /* â”€â”€â”€ Reset & Base â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      color: var(--text);
      background: var(--bg);
      line-height: 1.6;
      overflow-x: hidden;
    }

    /* â”€â”€â”€ Animated Background â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .bg-animation {
      position: fixed; inset: 0; z-index: -1;
      background:
        radial-gradient(ellipse 80% 50% at 50% -20%, rgba(88,166,255,0.15), transparent),
        radial-gradient(ellipse 60% 40% at 80% 100%, rgba(57,211,83,0.1), transparent);
      animation: bgShift 20s ease-in-out infinite;
    }
    @keyframes bgShift {
      0%,100% { opacity:1; transform:scale(1); }
      50%      { opacity:0.8; transform:scale(1.05); }
    }

    /* â”€â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    header {
      padding: 32px 24px;
      border-bottom: 1px solid var(--border);
      background: rgba(15,20,31,0.8);
      backdrop-filter: blur(20px) saturate(180%);
      position: sticky; top: 0; z-index: 500;
      box-shadow: 0 4px 20px rgba(0,0,0,0.3);
    }
    .header-content {
      max-width: 100%; margin: 0 auto;
      display: flex; justify-content: space-between; align-items: center;
      gap: 20px; flex-wrap: wrap;
    }
    .brand { display: flex; align-items: center; gap: 16px; }
    .brand-icon {
      width: 48px; height: 48px;
      background: var(--grad-1); border-radius: 12px;
      display: flex; align-items: center; justify-content: center;
      font-size: 24px;
      box-shadow: 0 4px 12px var(--accent-glow);
      animation: float 3s ease-in-out infinite;
    }
    @keyframes float {
      0%,100% { transform: translateY(0); }
      50%      { transform: translateY(-5px); }
    }
    .brand-text h1 {
      font-size: 26px; font-weight: 800; letter-spacing: -0.5px;
      background: linear-gradient(135deg, var(--text-bright), var(--accent2));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    .brand-text .tagline { color: var(--muted); font-size: 13px; margin-top: 2px; }

    /* â”€â”€â”€ Layout â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .container { max-width: 100%; margin: 0 auto; padding: 24px; }
    .layout {
      display: grid;
      grid-template-columns: 1.3fr 1fr;
      gap: 24px;
      margin-bottom: 24px;
    }
    @media (max-width: 1200px) { .layout { grid-template-columns: 1fr; } #map { height: 480px; } }
    @media (max-width: 768px)  {
      .header-content { flex-direction: column; align-items: flex-start; }
      .metrics-grid   { grid-template-columns: repeat(2,1fr); }
      #map            { height: 380px; }
    }
    @media (max-width: 480px)  {
      .metrics-grid { grid-template-columns: 1fr; }
      .cards-grid   { grid-template-columns: 1fr; }
    }

    /* â”€â”€â”€ Panels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .panel {
      background: var(--panel); border: 1px solid var(--border);
      border-radius: 16px; padding: 24px;
      box-shadow: 0 8px 32px rgba(0,0,0,0.3);
      transition: all 0.3s ease;
      position: relative; overflow: hidden;
    }
    .panel::before {
      content: ''; position: absolute; top: 0; left: 0; right: 0; height: 3px;
      background: var(--grad-1); opacity: 0; transition: opacity 0.3s ease;
    }
    .panel:hover::before { opacity: 1; }
    .panel-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; }
    .panel-title  { font-size: 20px; font-weight: 700; display: flex; align-items: center; gap: 10px; }
    .panel-icon   {
      width: 32px; height: 32px; background: var(--grad-3);
      border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 16px;
    }

    /* â”€â”€â”€ Map â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    #map {
      height: 580px; width: 100%;
      border-radius: 12px; border: 1px solid var(--border-bright);
      box-shadow: 0 0 0 1px rgba(0,0,0,0.1) inset, 0 12px 40px rgba(0,0,0,0.4);
      overflow: hidden; margin-bottom: 16px;
    }

    /* â”€â”€â”€ Buttons â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .controls { display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 16px; }
    .btn {
      padding: 10px 18px; border-radius: 10px;
      border: 1px solid var(--border); background: var(--bg-elevated);
      color: var(--text); cursor: pointer;
      transition: all 0.2s ease; font-size: 14px; font-weight: 500;
      position: relative; overflow: hidden;
    }
    .btn::before {
      content: ''; position: absolute; inset: 0;
      background: linear-gradient(135deg, var(--accent2), var(--purple));
      opacity: 0; transition: opacity 0.2s ease;
    }
    .btn:hover  { transform: translateY(-2px); border-color: var(--accent2); box-shadow: 0 4px 12px var(--accent2-glow); }
    .btn:hover::before { opacity: 0.1; }
    .btn:active { transform: translateY(0); }
    .btn:disabled { opacity: 0.4; cursor: not-allowed; transform: none; box-shadow: none; }
    .btn.accent {
      background: linear-gradient(135deg,rgba(88,166,255,0.15),rgba(188,140,255,0.15));
      border-color: var(--accent2); color: var(--text-bright);
    }

    /* â”€â”€â”€ Legend â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .legend {
      display: grid; grid-template-columns: repeat(auto-fit,minmax(200px,1fr));
      gap: 12px; margin-top: 16px; padding: 16px;
      background: var(--bg-elevated); border-radius: 12px; border: 1px solid var(--border);
    }
    .legend-item {
      display: flex; align-items: center; gap: 10px;
      font-size: 13px; padding: 6px; border-radius: 6px; transition: background 0.2s ease;
    }
    .legend-item:hover { background: var(--panel); }
    .swatch {
      width: 16px; height: 16px; border-radius: 4px; flex-shrink: 0;
      border: 1px solid rgba(0,0,0,0.3); box-shadow: 0 2px 4px rgba(0,0,0,0.2);
    }

    /* â”€â”€â”€ Metrics â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .metrics-grid {
      display: grid; grid-template-columns: repeat(auto-fit,minmax(160px,1fr));
      gap: 16px; margin-bottom: 24px;
    }
    .metric {
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 12px; padding: 18px;
      transition: all 0.3s ease; position: relative; overflow: hidden;
    }
    .metric::before {
      content: ''; position: absolute; top: 0; left: 0; width: 4px; height: 100%;
      background: var(--grad-1); transform: scaleY(0); transition: transform 0.3s ease;
    }
    .metric:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.3); border-color: var(--border-bright); }
    .metric:hover::before { transform: scaleY(1); }
    .metric-label { color: var(--muted); font-size: 12px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.5px; margin-bottom: 8px; }
    .metric-value {
      font-size: 32px; font-weight: 800; margin-bottom: 6px;
      background: linear-gradient(135deg,var(--text-bright),var(--accent));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    .metric-hint { color: var(--muted); font-size: 11px; line-height: 1.4; }

    /* â”€â”€â”€ Cards â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .cards-grid { display: grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr)); gap: 16px; }
    .card {
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 12px; padding: 18px; transition: all 0.3s ease;
    }
    .card:hover { transform: translateY(-4px); box-shadow: 0 12px 28px rgba(0,0,0,0.3); border-color: var(--border-bright); }
    .card-title  { font-weight: 700; font-size: 15px; margin-bottom: 10px; color: var(--text-bright); }
    .card-content { color: var(--muted); font-size: 13px; line-height: 1.6; }

    /* â”€â”€â”€ Details/Accordion â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    details {
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 12px; padding: 16px; margin: 16px 0; transition: all 0.3s ease;
    }
    details[open] { border-color: var(--accent2); box-shadow: 0 4px 12px var(--accent2-glow); }
    summary {
      cursor: pointer; font-weight: 700; font-size: 15px;
      display: flex; align-items: center; gap: 10px;
      user-select: none; list-style: none; transition: color 0.2s ease;
    }
    summary:hover { color: var(--accent2); }
    summary::before { content: 'â–¶'; font-size: 12px; transition: transform 0.3s ease; }
    details[open] summary::before { transform: rotate(90deg); }
    details > div {
      margin-top: 12px; color: var(--muted); font-size: 14px;
      line-height: 1.7; padding-top: 12px; border-top: 1px solid var(--border);
    }

    /* â”€â”€â”€ Methodology â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .methods { margin-top: 20px; }
    .methods h3 { font-size: 18px; margin-bottom: 12px; color: var(--text-bright); }
    .methods ul { list-style: none; padding: 0; }
    .methods li {
      padding: 10px 0 10px 28px; position: relative;
      color: var(--muted); font-size: 14px; line-height: 1.6;
    }
    .methods li::before { content: 'â†’'; position: absolute; left: 0; color: var(--accent); font-weight: bold; }

    /* â”€â”€â”€ Section Headings â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    h2 {
      font-size: 22px; font-weight: 800; margin: 24px 0 16px;
      background: linear-gradient(135deg,var(--text-bright),var(--accent2));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
    }
    h3 { font-size: 18px; font-weight: 700; margin: 20px 0 12px; color: var(--text-bright); }
    h4 { font-size: 14px; font-weight: 600; margin: 16px 0 10px; color: var(--muted); text-transform: uppercase; letter-spacing: 0.5px; }

    /* â”€â”€â”€ Footer â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    footer {
      padding: 32px 24px; text-align: center;
      color: var(--muted); font-size: 13px;
      border-top: 1px solid var(--border); background: var(--bg-elevated);
    }

    /* â”€â”€â”€ Scrollbar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    ::-webkit-scrollbar       { width: 10px; height: 10px; }
    ::-webkit-scrollbar-track { background: var(--bg); }
    ::-webkit-scrollbar-thumb { background: var(--border-bright); border-radius: 5px; }
    ::-webkit-scrollbar-thumb:hover { background: var(--muted); }

    /* â”€â”€â”€ Modals (shared base) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,0.85); backdrop-filter: blur(10px);
      display: none; align-items: center; justify-content: center;
      z-index: 1000;
    }
    .modal.open { display: flex; }

    @keyframes fadeIn  { from { opacity:0; }               to { opacity:1; } }
    @keyframes slideUp { from { transform:translateY(20px); opacity:0; } to { transform:translateY(0); opacity:1; } }

    .modal-box {
      background: var(--panel); border: 1px solid var(--border-bright);
      border-radius: 16px; max-width: 96vw; max-height: 92vh;
      padding: 20px; display: flex; flex-direction: column; gap: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      animation: slideUp 0.3s ease;
    }
    .modal-toolbar { display: flex; justify-content: space-between; align-items: center; }
    .modal-title   { font-weight: 700; font-size: 18px; }

    .icon-btn {
      padding: 8px 16px; border-radius: 8px;
      border: 1px solid var(--border); background: var(--bg-elevated);
      color: var(--text); cursor: pointer;
      transition: all 0.2s ease; font-size: 14px; font-weight: 500;
    }
    .icon-btn:hover { background: var(--panel-hover); border-color: var(--border-bright); transform: translateY(-1px); }

    /* â”€â”€â”€ Species Flip Card â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .flip-card-container { perspective: 1200px; width: 550px; margin: 0 auto; }
    .flip-card {
      width: 550px; height: 600px;
      position: relative; transform-style: preserve-3d;
      transition: transform 0.7s ease;
    }
    .flip-card.flipped { transform: rotateY(180deg); }
    .card-face {
      position: absolute; width: 100%; height: 100%;
      border-radius: 16px; backface-visibility: hidden;
      overflow: hidden; box-shadow: 0 8px 32px rgba(0,0,0,0.3);
    }

    /* Front */
    .card-front { background: #000; }
    .species-image { width: 100%; height: 100%; object-fit: cover; }
    .image-overlay {
      position: absolute; bottom: 0; width: 100%; padding: 30px;
      background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
    }
    .overlay-content h2    { color: white; font-size: 28px; font-weight: 700; margin: 0 0 8px; -webkit-text-fill-color: white; }
    .overlay-content .sci  { color: rgba(255,255,255,0.85); font-size: 16px; font-style: italic; margin-bottom: 16px; }

    /* Back */
    .card-back {
      background: var(--panel); transform: rotateY(180deg);
      display: flex; flex-direction: column; padding: 30px;
    }
    .back-header { display: flex; justify-content: space-between; align-items: flex-start; margin-bottom: 20px; }
    .back-header h2 { color: var(--text-bright); font-size: 24px; margin: 0; -webkit-text-fill-color: var(--text-bright); }
    .details-content { flex: 1; overflow-y: auto; }
    .info-section { margin-bottom: 20px; }
    .info-section h4 { color: var(--accent2); font-size: 14px; font-weight: 600; margin-bottom: 8px; text-transform: none; letter-spacing: 0; }
    .info-section p  { color: var(--muted); font-size: 14px; line-height: 1.6; margin: 0; }

    /* Shared flip button */
    .flip-btn {
      background: rgba(255,255,255,0.15); border: 1px solid rgba(255,255,255,0.4);
      color: white; padding: 10px 20px; border-radius: 25px;
      cursor: pointer; font-size: 14px; font-weight: 500;
      transition: all 0.3s ease; backdrop-filter: blur(6px);
    }
    .flip-btn:hover { background: white; color: black; }
    .flip-btn.back-btn { margin-top: 20px; background: var(--accent2); border-color: var(--accent2); }
    .flip-btn.back-btn:hover { background: #4a8ed9; color: white; }

    .close-circle-btn {
      position: absolute; top: 16px; right: 16px;
      background: rgba(0,0,0,0.6); color: white; border: none;
      width: 36px; height: 36px; border-radius: 50%;
      cursor: pointer; font-size: 20px; line-height: 1;
      display: flex; align-items: center; justify-content: center;
      transition: all 0.2s ease; z-index: 10;
    }
    .close-circle-btn:hover { background: rgba(0,0,0,0.8); transform: rotate(90deg); }

    /* Leaflet popup button */
    .leaflet-popup-content { margin: 14px; }
    .view-species-btn {
      display: inline-block; margin-top: 8px; padding: 8px 16px;
      background: linear-gradient(135deg,var(--accent2),var(--purple));
      color: white; border: none; border-radius: 8px;
      cursor: pointer; font-size: 13px; font-weight: 600;
      transition: all 0.2s ease;
    }
    .view-species-btn:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(88,166,255,0.4); }

    /* â”€â”€â”€ Index / Habitat Modal (large) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .big-modal-box {
      background: var(--panel); border: 1px solid var(--border-bright);
      border-radius: 20px; max-width: 1200px; width: 95vw; max-height: 90vh;
      overflow-y: auto; box-shadow: 0 20px 60px rgba(0,0,0,0.5);
      animation: slideUp 0.3s ease;
    }
    .big-modal-header {
      padding: 30px 30px 20px; border-bottom: 1px solid var(--border);
      display: flex; justify-content: space-between; align-items: center;
      position: sticky; top: 0; background: var(--panel); z-index: 10;
    }
    .big-modal-title {
      font-size: 28px; font-weight: 800;
      background: linear-gradient(135deg,var(--text-bright),var(--accent2));
      -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
      display: flex; align-items: center; gap: 12px;
    }
    .big-modal-body { padding: 30px; }
    .two-col { display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin-bottom: 30px; }

    .chart-box {
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 16px; padding: 30px;
    }
    .chart-box h4 { margin-bottom: 20px; color: var(--text-bright); }
    .chart-wrap { height: 400px; }

    /* Index table */
    .idx-table-box {
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 16px; padding: 20px;
    }
    .idx-table { width: 100%; border-collapse: collapse; }
    .idx-table th {
      background: var(--panel-hover); padding: 16px; text-align: left;
      font-weight: 600; color: var(--accent2); font-size: 14px;
      text-transform: uppercase; letter-spacing: 0.5px;
    }
    .idx-table td { padding: 14px 16px; border-top: 1px solid var(--border); color: var(--text); font-size: 14px; }
    .idx-table tr:hover td { background: var(--panel-hover); }
    .habitat-label { font-weight: 600; color: var(--text-bright); }

    /* Insight cards grid */
    .insight-grid {
      display: grid; grid-template-columns: repeat(auto-fit,minmax(280px,1fr));
      gap: 20px; margin-top: 30px;
    }
    .insight-card {
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 12px; padding: 20px; transition: all 0.3s ease;
    }
    .insight-card:hover { transform: translateY(-4px); box-shadow: 0 8px 24px rgba(0,0,0,0.3); border-color: var(--border-bright); }
    .insight-card h3 { font-size: 16px; font-weight: 700; color: var(--text-bright); margin-bottom: 12px; }
    .insight-card p  { font-size: 14px; color: var(--muted); line-height: 1.6; }

    /* Description strip below charts */
    .desc-strip {
      background: var(--bg-elevated); border: 1px solid var(--border);
      border-radius: 12px; padding: 20px; margin-top: 20px;
    }
    .desc-strip p { color: var(--text); font-size: 15px; line-height: 1.7; }

    /* â”€â”€â”€ Ornamental Gallery Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ */
    .gallery-inner { text-align: center; }
    .gallery-img {
      max-width: 100%; max-height: 60vh;
      border-radius: 12px; margin-bottom: 20px;
      display: block; margin-left: auto; margin-right: auto;
    }
    .gallery-nav { display: flex; justify-content: center; align-items: center; gap: 20px; margin-bottom: 10px; }
    .gallery-counter { color: var(--muted); font-size: 14px; min-width: 50px; text-align: center; }
    .gallery-name { color: var(--text-bright); font-size: 20px; font-weight: 700; margin-top: 8px; }
  </style>
</head>
<body>

<div class="bg-animation"></div>

<!-- â”€â”€ Header â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<header>
  <div class="header-content">
    <div class="brand">
      <div class="brand-icon">ğŸŒ¿</div>
      <div class="brand-text">
        <h1>BITS Hyderabad Biodiversity Atlas</h1>
        <div class="tagline">Advanced GIS mapping â€¢ Field surveys â€¢ Campus-wide diversity analytics</div>
      </div>
    </div>
  </div>
</header>

<!-- â”€â”€ Main â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
<div class="container">
  <div class="layout">

    <!-- Left: Map Panel -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <div class="panel-icon">ğŸ—ºï¸</div>
          Interactive Campus Map
        </div>
      </div>

      <div class="controls">
        <button class="btn accent" id="btn-campus">ğŸ« Campus Overview</button>
        <button class="btn" id="btn-urban">ğŸ˜ï¸ Urban Transects</button>
        <button class="btn" id="btn-forests">ğŸŒ² Forest Quadrats</button>
        <button class="btn" id="btn-points">ğŸ“ Sampling Points</button>
      </div>

      <div id="map"></div>

      <div class="legend">
        <div class="legend-item"><span class="swatch" style="background:#3fb950"></span>Campus Boundary</div>
        <div class="legend-item"><span class="swatch" style="background:#d29922"></span>Urbanized Areas</div>
        <div class="legend-item"><span class="swatch" style="background:#2ea043"></span>Forested Areas</div>
        <div class="legend-item"><span class="swatch" style="background:#58a6ff"></span>Water Bodies</div>
        <div class="legend-item"><span class="swatch" style="background:#9b59b6"></span>Gardens & Lawns</div>
      </div>

      <div class="methods">
        <h3>Methodology</h3>
        <ul>
          <li>Interactive mapping using Leaflet.js with OpenStreetMap tiles</li>
          <li>50Ã—50m quadrats for comprehensive forested area surveys</li>
          <li>100m line transects along urbanized corridors</li>
          <li>Strategic point sampling for gardens, lawns, and aquatic habitats</li>
        </ul>
      </div>
    </div>

    <!-- Right: Data Panel -->
    <div class="panel">
      <div class="panel-header">
        <div class="panel-title">
          <div class="panel-icon">ğŸ“Š</div>
          Diversity Metrics
        </div>
      </div>

      <h2>Campus-Wide Analysis</h2>
      <div class="metrics-grid">
        <div class="metric">
          <div class="metric-label">Shannon-Wiener (Hâ€²)</div>
          <div class="metric-value">1.37</div>
          <div class="metric-hint">Lowâ€“moderate diversity; dominated by few groups</div>
        </div>
        <div class="metric">
          <div class="metric-label">Simpson's D</div>
          <div class="metric-value">0.458</div>
          <div class="metric-hint">46% probability same group</div>
        </div>
        <div class="metric">
          <div class="metric-label">Simpson's (1âˆ’D)</div>
          <div class="metric-value">0.542</div>
          <div class="metric-hint">Moderate group distinction</div>
        </div>
        <div class="metric">
          <div class="metric-label">Evenness (J)</div>
          <div class="metric-value">0.59</div>
          <div class="metric-hint">Uneven distribution pattern</div>
        </div>
      </div>

      <details open>
        <summary>Key Insights</summary>
        <div>
          The Shannon-Wiener index (Hâ€² = 1.37) and Simpson's diversity (1âˆ’D = 0.54) reveal moderate overall
          diversity with significant compositional skew. Trees constitute approximately 50% of recorded species,
          while terrestrial plants account for 25%. The evenness index (J = 0.59) confirms imbalanced abundance
          distribution across taxonomic groups, suggesting opportunities for biodiversity enhancement.
        </div>
      </details>

      <h3>Habitat-Specific Indices</h3>
      <div class="cards-grid">
        <div class="card">
          <div class="card-title">ğŸ˜ï¸ Urbanized Zones</div>
          <div class="card-content"><strong>Hâ€² 1.368</strong> â€¢ <strong>1âˆ’D 0.708</strong> â€¢ <strong>J 0.703</strong><br>Most balanced species composition among all surveyed habitats.</div>
        </div>
        <div class="card">
          <div class="card-title">ğŸŒ² Forested Areas</div>
          <div class="card-content"><strong>Hâ€² 1.195</strong> â€¢ <strong>1âˆ’D 0.616</strong> â€¢ <strong>J 0.575</strong><br>Moderate diversity. Terrestrial plants (55%) and trees (25%) dominate.</div>
        </div>
        <div class="card">
          <div class="card-title">ğŸŒº Gardens & Lawns</div>
          <div class="card-content"><strong>Hâ€² 0.815</strong> â€¢ <strong>1âˆ’D 0.467</strong> â€¢ <strong>J 0.455</strong><br>Dominated by trees (~67.5%) and terrestrial plants (~27.6%).</div>
        </div>
        <div class="card">
          <div class="card-title">ğŸ’§ Water Bodies</div>
          <div class="card-content"><strong>Hâ€² 0.552</strong> â€¢ <strong>1âˆ’D 0.266</strong> â€¢ <strong>J 0.398</strong><br>Aquatic plants dominate (~85%). Lowest diversity among habitats.</div>
        </div>
      </div>

      <h3>Data Visualizations</h3>

      <h4>Overall Campus</h4>
      <div class="controls">
        <button class="btn accent" onclick="window.location.href='biodiversity-chart.html'">ğŸ“Š Overall Abundance Chart</button>
      </div>

      <h4>Comparative Indices</h4>
      <div class="controls">
        <button class="btn" onclick="openIndexModal('shannon')">ğŸ“ˆ Shannon Index by Habitat</button>
        <button class="btn" onclick="openIndexModal('simpson')">ğŸ“‰ Simpson's Index by Habitat</button>
        <button class="btn" onclick="openIndexModal('evenness')">âš–ï¸ Evenness by Habitat</button>
      </div>

      <h4>Habitat Composition</h4>
      <div class="controls">
        <button class="btn" onclick="openHabitatModal('gardens')">ğŸŒº Gardens & Lawns</button>
        <button class="btn" onclick="openHabitatModal('forests')">ğŸŒ² Forested Areas</button>
        <button class="btn" onclick="openHabitatModal('urban')">ğŸ˜ï¸ Urban Transects</button>
        <button class="btn" onclick="openHabitatModal('water')">ğŸ’§ Water Bodies</button>
      </div>

      <h4>Ornamental Plants</h4>
      <div class="controls">
        <button class="btn" onclick="openOrnamentalGallery('rocks')">ğŸª¨ Rocks</button>
        <button class="btn" onclick="openOrnamentalGallery('newacad')">ğŸŒ¸ New Acad Pathway</button>
      </div>
    </div>

  </div><!-- /.layout -->
</div><!-- /.container -->

<footer>BITS Pilani Hyderabad Campus Biodiversity Project</footer>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     MODALS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->

<!-- Species Flip Card -->
<div class="modal" id="speciesModal">
  <div class="modal-box" style="max-width:550px;width:550px;padding:0;overflow:visible;background:transparent;border:none;box-shadow:none;">
    <div style="perspective:1200px;width:550px;margin:0 auto;">
      <div class="flip-card" id="flipCard">

        <div class="card-face card-front">
          <img id="speciesImg" class="species-image" alt="Species photo">
          <div class="image-overlay">
            <div class="overlay-content">
              <h2 id="sp-name"></h2>
              <p class="sci" id="sp-sci"></p>
              <button class="flip-btn" onclick="flipCard()">View Details â†’</button>
            </div>
          </div>
          <button class="close-circle-btn" onclick="closeSpeciesModal()">Ã—</button>
        </div>

        <div class="card-face card-back">
          <div class="back-header"><h2 id="sp-name-back"></h2></div>
          <div class="details-content">
            <div class="info-section"><h4>ğŸ“ Location</h4><p id="sp-location"></p></div>
            <div class="info-section"><h4>ğŸŒ± Habitat</h4><p id="sp-habitat"></p></div>
            <div class="info-section"><h4>â„¹ï¸ Description</h4><p id="sp-desc"></p></div>
            <div class="info-section"><h4>âœ¨ Additional Info</h4><p id="sp-extra"></p></div>
          </div>
          <button class="flip-btn back-btn" onclick="flipCard()">â† Back to Image</button>
          <button class="close-circle-btn" onclick="closeSpeciesModal()">Ã—</button>
        </div>

      </div>
    </div>
  </div>
</div>

<!-- Comparative Index Modal -->
<div class="modal" id="indexModal">
  <div class="big-modal-box">
    <div class="big-modal-header">
      <div class="big-modal-title">
        <span id="idx-icon"></span>
        <span id="idx-title"></span>
      </div>
      <button class="icon-btn" onclick="closeIndexModal()">âœ• Close</button>
    </div>
    <div class="big-modal-body">
      <div class="two-col">
        <div class="chart-box"><div class="chart-wrap"><canvas id="indexChart"></canvas></div></div>
        <div class="idx-table-box">
          <table class="idx-table">
            <thead><tr><th>Habitat</th><th id="idx-col-header">Value</th></tr></thead>
            <tbody id="idx-table-body"></tbody>
          </table>
        </div>
      </div>
      <div class="insight-grid" id="idx-insights"></div>
    </div>
  </div>
</div>

<!-- Habitat Composition Modal -->
<div class="modal" id="habitatModal">
  <div class="big-modal-box">
    <div class="big-modal-header">
      <div class="big-modal-title">
        <span id="hab-icon"></span>
        <span id="hab-title"></span>
      </div>
      <button class="icon-btn" onclick="closeHabitatModal()">âœ• Close</button>
    </div>
    <div class="big-modal-body">
      <div class="two-col">
        <div class="chart-box"><h4>Species Composition</h4><div class="chart-wrap"><canvas id="habBarChart"></canvas></div></div>
        <div class="chart-box"><h4>Distribution</h4><div class="chart-wrap"><canvas id="habPieChart"></canvas></div></div>
      </div>
      <div class="desc-strip"><p id="hab-desc"></p></div>
    </div>
  </div>
</div>

<!-- Ornamental Plants Gallery Modal -->
<div class="modal" id="ornamentalModal">
  <div class="modal-box" style="max-width:900px;width:95vw;">
    <div class="modal-toolbar">
      <div class="modal-title" id="orn-title">Ornamental Plants</div>
      <button class="icon-btn" onclick="closeOrnamentalModal()">âœ• Close</button>
    </div>
    <div class="gallery-inner">
      <img id="orn-img" class="gallery-img" alt="Ornamental plant">
      <div class="gallery-nav">
        <button class="btn" id="orn-prev" onclick="ornNavigate(-1)">â† Previous</button>
        <span class="gallery-counter" id="orn-counter">1 / 1</span>
        <button class="btn" id="orn-next" onclick="ornNavigate(1)">Next â†’</button>
      </div>
      <div class="gallery-name" id="orn-name"></div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     SCRIPTS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
<script>
'use strict';

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   DATA
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const SPECIES = {
  P1: { name:'Indian Blanket Flower', sci:'Gaillardia pulchella', img:'rightrocks.jpeg',
        location:'Right side of Rocks', habitat:'Garden and lawn areas',
        desc:'A bright, colourful wildflower with red and yellow daisy-like blooms. The petals are deep red in the centre with yellow tips, giving it a blanket-like pattern.',
        extra:'The name "Indian Blanket" refers to the flower\'s colours, which resemble traditional Native American woven blankets.' },
  P2: { name:'Bamboo', sci:'Bambusa sp.', img:'leftrocks.jpeg',
        location:'Left side of Rocks', habitat:'Moist, open areas',
        desc:'A fast-growing plant belonging to the grass family with tall, hollow, jointed stems called culms and narrow green leaves. Some species are the fastest-growing plants in the world.',
        extra:'Technically a grass, not a tree. Some species can grow up to 90 cm in a single day under ideal conditions.' },
  P3: { name:'(Unassigned)', sci:'â€”', img:'placeholder.jpg',
        location:'Garden/Lawn Point P3', habitat:'Garden and lawn areas',
        desc:'Species data not yet assigned for this point.', extra:'â€”' },
  P4: { name:'Oleander', sci:'Nerium oleander', img:'malaviyaqt.jpeg',
        location:'Malaviya QT', habitat:'Garden and lawn areas',
        desc:'A hardy, evergreen flowering shrub with attractive clusters of bright flowers (pink, white, red, yellow, or peach) and long, narrow leaves. Widely planted for ornamental purposes.',
        extra:'All parts are poisonous. Despite its toxicity it is extremely resilient and can survive drought, poor soil, and heavy pollution.' },
  P5: { name:'(Unassigned)', sci:'â€”', img:'placeholder.jpg',
        location:'Garden/Lawn Point P5', habitat:'Garden and lawn areas',
        desc:'Species data not yet assigned for this point.', extra:'â€”' },
  P6: { name:'(Unassigned)', sci:'â€”', img:'placeholder.jpg',
        location:'Garden/Lawn Point P6', habitat:'Garden and lawn areas',
        desc:'Species data not yet assigned for this point.', extra:'â€”' },
  P7: { name:'Sago Palm', sci:'Cycas revoluta', img:'liblawns.jpeg',
        location:'Library Lawns', habitat:'Garden and lawn areas',
        desc:'A slow-growing, evergreen plant with a thick, rough trunk and a symmetrical crown of stiff, glossy, dark-green leaves. Despite its name it belongs to the ancient cycad family, not true palms.',
        extra:'One of the oldest plant lineages on Earth, dating back over 200 million years.' },
  P8: { name:'Royal Palm Tree', sci:'Roystonea regia', img:'chesscourt.jpeg',
        location:'Chess Courtyard', habitat:'Garden and lawn areas',
        desc:'A tall, elegant palm tree known for its smooth, light-grey trunk and a perfectly rounded crown of large, feather-like leaves towering over the BITS Hyderabad campus.',
        extra:'Commonly planted as an ornamental tree in avenues, resorts, and gardens.' },
  W1: { name:'Water Lily', sci:'Nymphaea sp.', img:'water_lily.jpg',
        location:'Water Body â€” Lotus Pond', habitat:'Aquatic habitat with calm, shallow water',
        desc:'A beautiful aquatic flowering plant found in the water bodies of BITS Hyderabad campus.',
        extra:'Water lilies reduce algae growth and indicate good water quality.' },
  W2: { name:'Duckweed', sci:'Lemna minor', img:'duckweed.jpg',
        location:'Water Body â€” Pond near gate', habitat:'Still freshwater ecosystems',
        desc:'A tiny floating aquatic plant commonly found in still freshwater bodies.',
        extra:'Acts as a bioindicator species for water quality.' }
};

const INDEX_DATA = {
  shannon: {
    icon:'ğŸ“ˆ', title:"Shannon Diversity Index â€“ What It Shows", colHeader:"Shannon (Hâ€²)",
    rows:[
      { habitat:'Gardens & Lawns', value:0.815, color:'#4facfe' },
      { habitat:'Forested Areas',  value:1.195, color:'#feca57' },
      { habitat:'Water Bodies',    value:0.552, color:'#0fbcf9' },
      { habitat:'Urban Areas',     value:1.368, color:'#ff6b6b' }
    ],
    insights:[
      { title:'ğŸ˜ï¸ Urban areas',    text:'Highest value â€” the greatest variety with a fairly balanced presence. Mixed spaces create diverse niches.' },
      { title:'ğŸŒ² Forested areas', text:'Moderate diversity; multiple species present though trees and terrestrial plants still dominate.' },
      { title:'ğŸŒº Gardens & lawns',text:'Lower diversity, mainly because these are landscaped and contain a limited variety of planted species.' },
      { title:'ğŸ’§ Water bodies',   text:'Lowest diversity; heavily dominated by aquatic plants with few fish, insects, and birds.' }
    ],
    takeaway:'Urban areas, even though human-modified, support the most diverse and balanced communities, while water bodies are specialised habitats dominated by aquatic plants.'
  },
  simpson: {
    icon:'ğŸ“‰', title:"Simpson's Diversity Index â€“ What It Shows", colHeader:"Simpson's (1âˆ’D)",
    rows:[
      { habitat:'Gardens & Lawns', value:0.467, color:'#4facfe' },
      { habitat:'Forested Areas',  value:0.616, color:'#feca57' },
      { habitat:'Water Bodies',    value:0.266, color:'#0fbcf9' },
      { habitat:'Urban Areas',     value:0.708, color:'#ff6b6b' }
    ],
    insights:[
      { title:'ğŸ˜ï¸ Urban areas',    text:'Highest value â€” no single species dominates; the community is well-balanced.' },
      { title:'ğŸŒ² Forested areas', text:'Fairly good balance, but trees and terrestrial plants still dominate to some extent.' },
      { title:'ğŸŒº Gardens & lawns',text:'Lower value; a few planted species such as trees and shrubs make up most of the population.' },
      { title:'ğŸ’§ Water bodies',   text:'Lowest value; strongly dominated by aquatic plants with very little from other groups.' }
    ],
    takeaway:'Higher Simpson\'s value means less dominance. Urban areas are the least dominated by any one species; water bodies are heavily dominated by aquatic plants.'
  },
  evenness: {
    icon:'âš–ï¸', title:"Evenness (J) Index â€“ What It Shows", colHeader:"Evenness (J)",
    rows:[
      { habitat:'Gardens & Lawns', value:0.455, color:'#4facfe' },
      { habitat:'Forested Areas',  value:0.575, color:'#feca57' },
      { habitat:'Water Bodies',    value:0.398, color:'#0fbcf9' },
      { habitat:'Urban Areas',     value:0.703, color:'#ff6b6b' }
    ],
    insights:[
      { title:'ğŸ˜ï¸ Urban areas',    text:'Highest evenness â€” species are more evenly distributed and no single group dominates.' },
      { title:'ğŸŒ² Forested areas', text:'Moderate evenness with some balance but a noticeable dominance of trees and terrestrial plants.' },
      { title:'ğŸŒº Gardens & lawns',text:'Lower evenness; a few planted species dominate, leaving less room for variety.' },
      { title:'ğŸ’§ Water bodies',   text:'Lowest evenness; most of the habitat is occupied by aquatic plants.' }
    ],
    takeaway:'Urban areas have the most balanced distribution of species, while water bodies are highly uneven with one group dominating most of the space.'
  }
};

const HABITAT_DATA = {
  gardens: {
    icon:'ğŸŒº', title:'Gardens and Lawns', subtitle:'(Rock garden, Hostel QTs, etc)',
    rows:[
      { label:'Tree',               count:2070, color:'#7cb5ec' },
      { label:'Terrestrial Plants', count:845,  color:'#90ed7d' },
      { label:'Shrubs',             count:100,  color:'#f7a35c' },
      { label:'Bird',               count:31,   color:'#8085e9' },
      { label:'Mammals',            count:15,   color:'#f15c80' },
      { label:'Insect',             count:5,    color:'#e4d354' }
    ],
    desc:'The species composition in Gardens is heavily dominated by Trees and Terrestrial Plants, which together make up the vast majority of the population. Overall, Gardens are plant-rich environments with minimal representation of animal species.'
  },
  forests: {
    icon:'ğŸŒ²', title:'Forested Areas', subtitle:'(Quadrats behind and around NAB)',
    rows:[
      { label:'Terrestrial Plants', count:1521, color:'#7cb5ec' },
      { label:'Tree',               count:680,  color:'#434348' },
      { label:'Shrubs',             count:295,  color:'#90ed7d' },
      { label:'Insects',            count:188,  color:'#f7a35c' },
      { label:'Bird',               count:54,   color:'#8085e9' },
      { label:'Mammal',             count:5,    color:'#f15c80' },
      { label:'Reptiles',           count:3,    color:'#e4d354' },
      { label:'Amphibian',          count:1,    color:'#2b908f' }
    ],
    desc:'The species composition in Forested Areas shows a strong dominance of Terrestrial Plants, followed by Trees, indicating dense vegetation and rich plant biodiversity. Faunal groups such as Insects and Mammals are present in moderate proportions, while Birds, Reptiles, and Amphibians make up very small fractions.'
  },
  urban: {
    icon:'ğŸ˜ï¸', title:'Urban Areas', subtitle:'(Roads along CP, Acad Block, OFG, etc)',
    rows:[
      { label:'Tree',               count:465,  color:'#7cb5ec' },
      { label:'Terrestrial Plants', count:338,  color:'#90ed7d' },
      { label:'Shrubs',             count:292,  color:'#f7a35c' },
      { label:'Bird',               count:59,   color:'#8085e9' },
      { label:'Insects',            count:26,   color:'#f15c80' },
      { label:'Mammals',            count:18,   color:'#e4d354' },
      { label:'Amphibians',         count:1,    color:'#2b908f' }
    ],
    desc:'Urban areas show a more balanced distribution of species compared to forests and gardens. While trees and terrestrial plants still dominate, their numbers are lower, indicating limited vegetation density. Shrubs, birds, and insects are relatively more common here than in gardens.'
  },
  water: {
    icon:'ğŸ’§', title:'Water Bodies', subtitle:'(Lotus Pond, Pond near gate)',
    rows:[
      { label:'Aquatic Plants', count:354, color:'#7cb5ec' },
      { label:'Fish',           count:33,  color:'#90ed7d' },
      { label:'Insect',         count:25,  color:'#f7a35c' },
      { label:'Bird',           count:4,   color:'#8085e9' }
    ],
    desc:'Water bodies show a clear dominance of aquatic plants, which make up the vast majority of the species count. Fish and insects appear in moderate numbers as consumers. Overall, water ecosystems exhibit low diversity but strong ecological specialisation, with plants forming the foundation for all other aquatic life.'
  }
};

const ORNAMENTAL_DATA = {
  rocks: {
    title:'Rocks Garden â€” Ornamental Plants',
    images:[
      { src:'rightrocks.jpeg', name:'Indian Blanket Flower (Gaillardia pulchella)' },
      { src:'leftrocks.jpeg',  name:'Bamboo (Bambusa sp.)' }
    ]
  },
  newacad: {
    title:'New Acad Pathway â€” Ornamental Plants',
    images:[
      { src:'plumeria_newacad.jpg', name:'Plumeria / Frangipani (Plumeria sp.)' }
    ]
  }
};

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MAP
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const map = L.map('map', { zoomControl:true }).setView([17.5449, 78.5718], 15);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  maxZoom: 20, attribution: 'Â© OpenStreetMap contributors'
}).addTo(map);

// Campus boundary
const campusLayer = L.geoJSON({
  type:'FeatureCollection',
  features:[{ type:'Feature', properties:{},
    geometry:{ type:'Polygon',
      coordinates:[[[78.5668,17.5485],[78.5790,17.5485],[78.5790,17.5380],[78.5668,17.5380],[78.5668,17.5485]]] }
  }]
}, { style:{ color:'#3fb950', weight:2, fillColor:'#3fb950', fillOpacity:0.05 } }).addTo(map);

// Urban transects
const transectCoords = [
  { id:'L1',  pts:[[78.571010,17.542245],[78.571856,17.541848]] },
  { id:'L2',  pts:[[78.575180,17.541521],[78.575576,17.542335]] },
  { id:'L3',  pts:[[78.576902,17.544862],[78.576484,17.544049]] },
  { id:'L4',  pts:[[78.577358,17.544505],[78.576913,17.543636]] },
  { id:'L5',  pts:[[78.574620,17.544121],[78.575478,17.543732]] },
  { id:'L6',  pts:[[78.576459,17.540301],[78.576849,17.541120]] },
  { id:'L7',  pts:[[78.569134,17.546008],[78.569576,17.546806]] },
  { id:'L8',  pts:[[78.572231,17.544418],[78.572213,17.544064],[78.572325,17.543832],[78.572560,17.543646]] },
  { id:'L9',  pts:[[78.573085,17.546857],[78.573978,17.546542]] },
  { id:'L10', pts:[[78.571318,17.545896],[78.571716,17.546722]] }
];
const urbanTransects = L.geoJSON({
  type:'FeatureCollection',
  features: transectCoords.map(t => ({
    type:'Feature', properties:{ id:t.id },
    geometry:{ type:'LineString', coordinates:t.pts }
  }))
}, {
  style:{ color:'#d29922', weight:4, opacity:0.9 },
  onEachFeature:(f,l) => l.bindPopup(`<b>Urban Transect ${f.properties.id}</b><br>Length: ~100m`)
}).addTo(map);

// Forested quadrats
const QUADRATS = {
  '1_1':[[78.568758,17.547811],[78.568758,17.547382],[78.568309,17.547382],[78.568309,17.547811],[78.568758,17.547811]],
  '1_2':[[78.568758,17.546954],[78.568758,17.546526],[78.568309,17.546526],[78.568309,17.546954],[78.568758,17.546954]],
  '1_3':[[78.569207,17.548239],[78.569207,17.547811],[78.568758,17.547811],[78.568758,17.548239],[78.569207,17.548239]],
  '1_4':[[78.569207,17.547382],[78.569207,17.546954],[78.568758,17.546954],[78.568758,17.547382],[78.569207,17.547382]],
  '1_5':[[78.570555,17.547811],[78.570555,17.547382],[78.570106,17.547382],[78.570106,17.547811],[78.570555,17.547811]],
  '2_1':[[78.568054,17.543482],[78.568054,17.543054],[78.567605,17.543054],[78.567605,17.543482],[78.568054,17.543482]],
  '2_2':[[78.568503,17.545623],[78.568503,17.545195],[78.568054,17.545195],[78.568054,17.545623],[78.568503,17.545623]],
  '3_1':[[78.570938,17.547167],[78.570938,17.546739],[78.570489,17.546739],[78.570489,17.547167],[78.570938,17.547167]],
  '4_1':[[78.569260,17.545005],[78.569260,17.544577],[78.568811,17.544577],[78.568811,17.545005],[78.569260,17.545005]]
};
const ZONE_STYLE = { 1:{ color:'#e91e63', fill:'#e91e63' }, 2:{ color:'#f44336', fill:'#f44336' }, 3:{ color:'#2196f3', fill:'#2196f3' } };
const zoneGroups = { 1: L.featureGroup(), 2: L.featureGroup(), 3: L.featureGroup() };

Object.entries(QUADRATS).forEach(([id, ring]) => {
  const zone = id.startsWith('1_') ? 1 : id.startsWith('2_') ? 2 : 3;
  const st = ZONE_STYLE[zone];
  L.polygon(ring.map(c => [c[1],c[0]]), { color:st.color, weight:2, fillColor:st.fill, fillOpacity:0.25 })
    .bindPopup(`<b>Quadrat ${id}</b><br>Zone ${zone} (Forested)<br>Size: 50Ã—50m`)
    .addTo(zoneGroups[zone]);
});
Object.values(zoneGroups).forEach(g => g.addTo(map));
const forestQuadrats = L.featureGroup(Object.values(zoneGroups));

// Garden / lawn sample points
const GARDEN_PTS = [
  { id:'P1', lat:17.544619, lon:78.572950 },
  { id:'P2', lat:17.543966, lon:78.572558 },
  { id:'P3', lat:17.541329, lon:78.574112 },
  { id:'P4', lat:17.541171, lon:78.574551 },
  { id:'P5', lat:17.544723, lon:78.574424 },
  { id:'P6', lat:17.542566, lon:78.574784 },
  { id:'P7', lat:17.545151, lon:78.571053 },
  { id:'P8', lat:17.545941, lon:78.569690 }
];
const WATER_PTS = [
  { id:'W1', lat:17.544299, lon:78.573217 },
  { id:'W2', lat:17.546605, lon:78.571864 }
];

function makeMarker(p, color, emoji) {
  const m = L.circleMarker([p.lat, p.lon], { radius:8, color, fillColor:color, fillOpacity:0.7, weight:2 });
  m.bindPopup(`
    <b>${emoji} Point ${p.id}</b><br>
    Lat: ${p.lat.toFixed(6)}<br>
    Lon: ${p.lon.toFixed(6)}<br>
    <button class="view-species-btn" onclick="openSpeciesModal('${p.id}')">ğŸŒ¿ View Species</button>
  `);
  return m;
}

const gardensLayer     = L.featureGroup(GARDEN_PTS.map(p => makeMarker(p,'#9b59b6','ğŸŒ¿'))).addTo(map);
const waterBodiesLayer = L.featureGroup(WATER_PTS.map(p => makeMarker(p,'#58a6ff','ğŸ’§'))).addTo(map);
const pointsLayer      = L.featureGroup([gardensLayer, waterBodiesLayer]);

// Fit & layer control
const allLayers = L.featureGroup([campusLayer, urbanTransects, forestQuadrats, pointsLayer]);
map.fitBounds(allLayers.getBounds(), { padding:[20,20] });

L.control.layers(null, {
  'Urbanized areas' : urbanTransects,
  'Forested areas'  : forestQuadrats,
  'Water bodies'    : waterBodiesLayer,
  'Gardens & lawns' : gardensLayer
}, { collapsed:false, position:'topright' }).addTo(map);

// Zoom buttons
document.getElementById('btn-campus').onclick  = () => map.fitBounds(campusLayer.getBounds(),   { padding:[20,20] });
document.getElementById('btn-urban').onclick   = () => map.fitBounds(urbanTransects.getBounds(),{ padding:[20,20] });
document.getElementById('btn-forests').onclick = () => map.fitBounds(forestQuadrats.getBounds(),{ padding:[20,20] });
document.getElementById('btn-points').onclick  = () => map.fitBounds(pointsLayer.getBounds(),   { padding:[20,20] });

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPECIES FLIP CARD
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
function openSpeciesModal(id) {
  const d = SPECIES[id];
  if (!d) return;
  document.getElementById('speciesImg').src    = d.img;
  document.getElementById('sp-name').textContent      = d.name;
  document.getElementById('sp-sci').textContent       = d.sci;
  document.getElementById('sp-name-back').textContent = d.name;
  document.getElementById('sp-location').textContent  = d.location;
  document.getElementById('sp-habitat').textContent   = d.habitat;
  document.getElementById('sp-desc').textContent      = d.desc;
  document.getElementById('sp-extra').textContent     = d.extra;
  document.getElementById('flipCard').classList.remove('flipped');
  document.getElementById('speciesModal').classList.add('open');
}
function closeSpeciesModal() {
  document.getElementById('speciesModal').classList.remove('open');
  setTimeout(() => document.getElementById('flipCard').classList.remove('flipped'), 300);
}
function flipCard() {
  document.getElementById('flipCard').classList.toggle('flipped');
}
document.getElementById('speciesModal').addEventListener('click', e => {
  if (e.target === document.getElementById('speciesModal')) closeSpeciesModal();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CHART HELPERS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
const CHART_DEFAULTS = {
  responsive: true, maintainAspectRatio: false,
  animation: { duration:1000, easing:'easeOutQuart' },
  plugins: {
    legend: { display:false },
    tooltip: {
      backgroundColor:'rgba(22,27,38,0.98)', titleColor:'#e6edf3',
      bodyColor:'#8b96a5', borderColor:'#3d4a5e', borderWidth:1, padding:14
    }
  }
};

function destroyChart(ref) { if (ref) { ref.destroy(); } return null; }

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   INDEX MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let indexChart = null;

function openIndexModal(type) {
  const d = INDEX_DATA[type];
  if (!d) return;

  document.getElementById('idx-icon').textContent   = d.icon;
  document.getElementById('idx-title').textContent  = d.title;
  document.getElementById('idx-col-header').textContent = d.colHeader;

  // Chart
  indexChart = destroyChart(indexChart);
  const ctx = document.getElementById('indexChart').getContext('2d');
  indexChart = new Chart(ctx, {
    type: 'bar',
    data: {
      labels: d.rows.map(r => r.habitat),
      datasets:[{ data: d.rows.map(r => r.value), backgroundColor: d.rows.map(r => r.color),
                  borderColor: d.rows.map(r => r.color), borderWidth:2, borderRadius:8 }]
    },
    options: {
      ...CHART_DEFAULTS,
      scales: {
        y: { beginAtZero:true, ticks:{ color:'#8b96a5' }, grid:{ color:'#2a3441' } },
        x: { ticks:{ color:'#8b96a5' }, grid:{ display:false } }
      },
      plugins: { ...CHART_DEFAULTS.plugins,
        tooltip: { ...CHART_DEFAULTS.plugins.tooltip,
          callbacks: { label: ctx => `${d.colHeader}: ${ctx.parsed.y.toFixed(3)}` }
        }
      }
    }
  });

  // Table
  document.getElementById('idx-table-body').innerHTML =
    d.rows.map(r => `<tr><td class="habitat-label">${r.habitat}</td><td><strong>${r.value.toFixed(3)}</strong></td></tr>`).join('');

  // Insights
  const insightHTML = d.insights.map(i =>
    `<div class="insight-card"><h3>${i.title}</h3><p>${i.text}</p></div>`
  ).join('') + `<div class="insight-card" style="grid-column:1/-1"><h3>ğŸ“Œ Key Takeaway</h3><p>${d.takeaway}</p></div>`;
  document.getElementById('idx-insights').innerHTML = insightHTML;

  document.getElementById('indexModal').classList.add('open');
}
function closeIndexModal() {
  document.getElementById('indexModal').classList.remove('open');
  indexChart = destroyChart(indexChart);
}
document.getElementById('indexModal').addEventListener('click', e => {
  if (e.target === document.getElementById('indexModal')) closeIndexModal();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   HABITAT MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let habBarChart = null, habPieChart = null;

function openHabitatModal(type) {
  const d = HABITAT_DATA[type];
  if (!d) return;

  document.getElementById('hab-icon').textContent = d.icon;
  document.getElementById('hab-title').innerHTML  =
    `${d.title} <span style="font-size:16px;font-weight:400;opacity:0.7">${d.subtitle}</span>`;
  document.getElementById('hab-desc').textContent = d.desc;

  habBarChart = destroyChart(habBarChart);
  habPieChart = destroyChart(habPieChart);

  // Bar chart
  habBarChart = new Chart(document.getElementById('habBarChart').getContext('2d'), {
    type: 'bar',
    data: {
      labels: d.rows.map(r => r.label),
      datasets:[{ data: d.rows.map(r => r.count), backgroundColor: d.rows.map(r => r.color),
                  borderColor: d.rows.map(r => r.color), borderWidth:2, borderRadius:6 }]
    },
    options: {
      ...CHART_DEFAULTS, indexAxis:'y',
      scales: {
        x: { beginAtZero:true, ticks:{ color:'#8b96a5', font:{size:11} }, grid:{ color:'#2a3441' } },
        y: { ticks:{ color:'#8b96a5', font:{size:11} }, grid:{ display:false } }
      },
      plugins: { ...CHART_DEFAULTS.plugins,
        tooltip: { ...CHART_DEFAULTS.plugins.tooltip,
          callbacks: { label: ctx => `Count: ${ctx.parsed.x.toLocaleString()}` }
        }
      }
    }
  });

  // Pie chart
  habPieChart = new Chart(document.getElementById('habPieChart').getContext('2d'), {
    type: 'pie',
    data: {
      labels: d.rows.map(r => r.label),
      datasets:[{ data: d.rows.map(r => r.count), backgroundColor: d.rows.map(r => r.color),
                  borderColor:'#0a0e17', borderWidth:2 }]
    },
    options: {
      ...CHART_DEFAULTS,
      plugins: { ...CHART_DEFAULTS.plugins,
        legend: { position:'bottom', labels:{ color:'#8b96a5', font:{size:11}, padding:10, usePointStyle:true } },
        tooltip: { ...CHART_DEFAULTS.plugins.tooltip,
          callbacks: { label: ctx => {
            const total = ctx.dataset.data.reduce((a,b) => a+b, 0);
            const pct   = ((ctx.parsed / total) * 100).toFixed(1);
            return `${ctx.label}: ${ctx.parsed.toLocaleString()} (${pct}%)`;
          }}
        }
      }
    }
  });

  document.getElementById('habitatModal').classList.add('open');
}
function closeHabitatModal() {
  document.getElementById('habitatModal').classList.remove('open');
  habBarChart = destroyChart(habBarChart);
  habPieChart = destroyChart(habPieChart);
}
document.getElementById('habitatModal').addEventListener('click', e => {
  if (e.target === document.getElementById('habitatModal')) closeHabitatModal();
});

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ORNAMENTAL GALLERY
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
let ornGallery = [], ornIdx = 0;

function openOrnamentalGallery(type) {
  const d = ORNAMENTAL_DATA[type];
  if (!d || !d.images.length) return;
  ornGallery = d.images;
  ornIdx = 0;
  document.getElementById('orn-title').textContent = d.title;
  renderOrnamental();
  document.getElementById('ornamentalModal').classList.add('open');
}
function renderOrnamental() {
  const img = ornGallery[ornIdx];
  document.getElementById('orn-img').src             = img.src;
  document.getElementById('orn-name').textContent    = img.name;
  document.getElementById('orn-counter').textContent = `${ornIdx + 1} / ${ornGallery.length}`;
  document.getElementById('orn-prev').disabled       = ornIdx === 0;
  document.getElementById('orn-next').disabled       = ornIdx === ornGallery.length - 1;
}
function ornNavigate(dir) {
  ornIdx = Math.max(0, Math.min(ornGallery.length - 1, ornIdx + dir));
  renderOrnamental();
}
function closeOrnamentalModal() {
  document.getElementById('ornamentalModal').classList.remove('open');
}
document.getElementById('ornamentalModal').addEventListener('click', e => {
  if (e.target === document.getElementById('ornamentalModal')) closeOrnamentalModal();
});
</script>
</body>
</html>
